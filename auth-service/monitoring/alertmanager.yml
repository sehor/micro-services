# AlertManageré…ç½®æ–‡ä»¶
global:
  # SMTPé…ç½®ï¼ˆé‚®ä»¶é€šçŸ¥ï¼‰
  smtp_smarthost: 'localhost:587'
  smtp_from: 'alerts@auth-supabase.com'
  smtp_auth_username: 'alerts@auth-supabase.com'
  smtp_auth_password: 'your-email-password'
  smtp_require_tls: true

  # Slacké…ç½®
  slack_api_url: 'https://hooks.slack.com/services/YOUR/SLACK/WEBHOOK'

# å‘Šè­¦è·¯ç”±é…ç½®
route:
  group_by: ['alertname', 'service']
  group_wait: 10s
  group_interval: 10s
  repeat_interval: 1h
  receiver: 'default-receiver'
  routes:
    # å…³é”®å‘Šè­¦ç«‹å³é€šçŸ¥
    - match:
        severity: critical
      receiver: 'critical-alerts'
      group_wait: 0s
      repeat_interval: 5m
    
    # è­¦å‘Šçº§åˆ«å‘Šè­¦
    - match:
        severity: warning
      receiver: 'warning-alerts'
      group_wait: 30s
      repeat_interval: 30m
    
    # è®¤è¯ç›¸å…³å‘Šè­¦
    - match:
        service: auth-supabase
      receiver: 'auth-alerts'
      group_wait: 15s

# æ¥æ”¶å™¨é…ç½®
receivers:
  # é»˜è®¤æ¥æ”¶å™¨
  - name: 'default-receiver'
    email_configs:
      - to: 'admin@auth-supabase.com'
        subject: '[Auth-Supabase] å‘Šè­¦é€šçŸ¥'
        body: |
          å‘Šè­¦è¯¦æƒ…:
          {{ range .Alerts }}
          å‘Šè­¦åç§°: {{ .Annotations.summary }}
          å‘Šè­¦æè¿°: {{ .Annotations.description }}
          å‘Šè­¦çº§åˆ«: {{ .Labels.severity }}
          æœåŠ¡åç§°: {{ .Labels.service }}
          å¼€å§‹æ—¶é—´: {{ .StartsAt }}
          {{ end }}

  # å…³é”®å‘Šè­¦æ¥æ”¶å™¨
  - name: 'critical-alerts'
    email_configs:
      - to: 'admin@auth-supabase.com,ops@auth-supabase.com'
        subject: '[CRITICAL] Auth-Supabase å…³é”®å‘Šè­¦'
        body: |
          ğŸš¨ å…³é”®å‘Šè­¦ ğŸš¨
          
          {{ range .Alerts }}
          å‘Šè­¦åç§°: {{ .Annotations.summary }}
          å‘Šè­¦æè¿°: {{ .Annotations.description }}
          æœåŠ¡åç§°: {{ .Labels.service }}
          å¼€å§‹æ—¶é—´: {{ .StartsAt }}
          
          è¯·ç«‹å³å¤„ç†ï¼
          {{ end }}
    
    slack_configs:
      - api_url: 'https://hooks.slack.com/services/YOUR/SLACK/WEBHOOK'
        channel: '#alerts-critical'
        title: 'ğŸš¨ Auth-Supabase å…³é”®å‘Šè­¦'
        text: |
          {{ range .Alerts }}
          *å‘Šè­¦*: {{ .Annotations.summary }}
          *æè¿°*: {{ .Annotations.description }}
          *æœåŠ¡*: {{ .Labels.service }}
          *æ—¶é—´*: {{ .StartsAt }}
          {{ end }}
        color: 'danger'

  # è­¦å‘Šçº§åˆ«æ¥æ”¶å™¨
  - name: 'warning-alerts'
    email_configs:
      - to: 'ops@auth-supabase.com'
        subject: '[WARNING] Auth-Supabase è­¦å‘Šå‘Šè­¦'
        body: |
          âš ï¸ è­¦å‘Šå‘Šè­¦ âš ï¸
          
          {{ range .Alerts }}
          å‘Šè­¦åç§°: {{ .Annotations.summary }}
          å‘Šè­¦æè¿°: {{ .Annotations.description }}
          æœåŠ¡åç§°: {{ .Labels.service }}
          å¼€å§‹æ—¶é—´: {{ .StartsAt }}
          {{ end }}
    
    slack_configs:
      - api_url: 'https://hooks.slack.com/services/YOUR/SLACK/WEBHOOK'
        channel: '#alerts-warning'
        title: 'âš ï¸ Auth-Supabase è­¦å‘Šå‘Šè­¦'
        text: |
          {{ range .Alerts }}
          *å‘Šè­¦*: {{ .Annotations.summary }}
          *æè¿°*: {{ .Annotations.description }}
          *æœåŠ¡*: {{ .Labels.service }}
          *æ—¶é—´*: {{ .StartsAt }}
          {{ end }}
        color: 'warning'

  # è®¤è¯æœåŠ¡ä¸“ç”¨æ¥æ”¶å™¨
  - name: 'auth-alerts'
    email_configs:
      - to: 'auth-team@auth-supabase.com'
        subject: '[Auth-Service] è®¤è¯æœåŠ¡å‘Šè­¦'
        body: |
          ğŸ” è®¤è¯æœåŠ¡å‘Šè­¦ ğŸ”
          
          {{ range .Alerts }}
          å‘Šè­¦åç§°: {{ .Annotations.summary }}
          å‘Šè­¦æè¿°: {{ .Annotations.description }}
          å‘Šè­¦çº§åˆ«: {{ .Labels.severity }}
          å¼€å§‹æ—¶é—´: {{ .StartsAt }}
          {{ end }}
    
    slack_configs:
      - api_url: 'https://hooks.slack.com/services/YOUR/SLACK/WEBHOOK'
        channel: '#auth-service'
        title: 'ğŸ” è®¤è¯æœåŠ¡å‘Šè­¦'
        text: |
          {{ range .Alerts }}
          *å‘Šè­¦*: {{ .Annotations.summary }}
          *æè¿°*: {{ .Annotations.description }}
          *çº§åˆ«*: {{ .Labels.severity }}
          *æ—¶é—´*: {{ .StartsAt }}
          {{ end }}

# æŠ‘åˆ¶è§„åˆ™
inhibit_rules:
  # å¦‚æœæœåŠ¡å®•æœºï¼ŒæŠ‘åˆ¶å…¶ä»–ç›¸å…³å‘Šè­¦
  - source_match:
      alertname: 'AuthServiceDown'
    target_match:
      service: 'auth-supabase'
    equal: ['service']
  
  # å¦‚æœæœ‰å…³é”®å‘Šè­¦ï¼ŒæŠ‘åˆ¶åŒç±»å‹çš„è­¦å‘Šå‘Šè­¦
  - source_match:
      severity: 'critical'
    target_match:
      severity: 'warning'
    equal: ['alertname', 'service']

# æ¨¡æ¿é…ç½®
templates:
  - '/etc/alertmanager/templates/*.tmpl'